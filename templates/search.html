<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Search – Modern and fast search engine with AI support.">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vRkX/v+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    
    <!-- Instrument Serif font for headers -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Instrument Sans as body font for nice contrast -->
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/landing.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/search.css') }}">

</head>
<body class="body-font">
    {% include 'includes/header.html' %}
    

<!-- Modal for the full AI response -->
<div class="modal fade" id="full-response-modal" tabindex="-1" aria-labelledby="fullResponseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="fullResponseModalLabel">Full AI Response</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="full-response-modal-body">
                <!-- The full response will be inserted here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

      
  
    <div class="empty-placeholder" style="height: 80px;"></div> <!-- Platzhalter für die feste Navbar -->

    <div class="container">
        <form class="d-flex w-100" method="POST" action="/search">
            <input id="search-input" class="form-control me-2 flex-grow-1 transparent-search" type="search" placeholder="Search" aria-label="Search" name="query" value="{{ request.args.get('query', '') }}">
            <!-- Updated select element with reduced width -->
            <select class="form-select me-2" name="type" id="type-select" style="max-width: 150px;">
                <option value="">Alle</option>
                {% for cat in categories %}
                    <option value="{{ cat }}" {% if cat == request.args.get('type', '') %} selected {% endif %}>
                        {{ cat }}
                    </option>
                {% endfor %}
            </select>
            <!-- Language filter -->
            <select class="form-select me-2" name="lang" id="lang-select" style="max-width: 150px;">
                <option value="">All</option>
                <option value="en-US" {% if request.args.get('lang', '') == 'en-US' %} selected {% endif %}>English</option>
                <option value="de-DE" {% if request.args.get('lang', '') == 'de-DE' %} selected {% endif %}>German</option>
                <!-- Add more options as needed -->
            </select>
            <button class="btn btn-outline-dark" type="submit">Search</button>
        </form>
    
        {% if message %}
        <div class="alert alert-warning">
            {{ message }}
        </div>
        {% endif %}
        <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 5">
            <div id="search-time-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#007bff" class="bi bi-search me-2" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                    </svg>
                    <strong class="me-auto">Search Duration</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    Query executed in {{ query_time | round(3) }} seconds.
                </div>
            </div>
            <div id="success-like-toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-heart-fill me-2" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314"/>
                    </svg>
                    <strong class="me-auto">Success</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    Link successfully liked!
                </div>
            </div>
            <div id="like-error" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-exclamation-triangle-fill me-2" viewBox="0 0 16 16">
                        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
                    </svg>
                    <strong class="me-auto">Error</strong>
                    <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    You can only like once per minute.
                </div>
            </div>
            
            <!-- Add more toasts here as needed -->
        </div>
        
        <div class="result-container">
            {% if query %}
                <br>
                <!-- Add placeholder for AI response that will be filled asynchronously -->
                <div id="ai-response-container"></div>
                
                <!-- New search content wrapper with knowledge panel -->
                <div class="search-content-wrapper">
                    <!-- Search results column -->
                    <div class="search-results-column">
                        <ul class="list-group">
                            {% if results %}
                                {% for result in results %}
                                    <li class="list-group-item result-item" data-url="{{ result.url }}">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div class="flex-grow-1 ms-3">
                                                {% if result.title %}
                                                    <a href="{{ result.url }}" target="_blank">
                                                        <!-- Favicon with lazy loading -->
                                                        <img class="fav-icon" data-url="{{ result.url }}" alt="Favicon" loading="lazy" style="width:16px;height:16px;margin-right:5px;display:none;">
                                                        {{ result.title }}
                                                        {% if 'source' in result and result.source == 'google' %}
                                                            <span class="badge bg-primary ms-2">Google</span>
                                                        {% endif %}
                                                    </a>
                                                {% else %}
                                                    <a href="{{ result.url }}" target="_blank"><em>No title available</em></a>
                                                {% endif %}
                                                <p class="url">{{ result.url }}</p>  <!-- result[0] is the URL -->
                                                {% if result.description %}  <!-- result.description is the description -->
                                                    <p class="mt-2">{{ result.description }}</p>
                                                {% else %}
                                                    <p class="mt-2"><em>No description available</em></p>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <!-- Preview tooltip container -->
                                        <div class="preview-tooltip">
                                            <div class="preview-loading">
                                                <div class="spinner-border spinner-border-sm text-primary me-2" role="status"></div>
                                                <span>Loading preview...</span>
                                            </div>
                                            <div class="preview-content" style="display: none;"></div>
                                            <div class="preview-error" style="display: none;">Preview could not be loaded</div>
                                        </div>
                                    </li>
                                {% endfor %}
                            {% else %}
                                <div class="alert alert-info" role="alert">
                                    No results found for your search query. Please try different keywords.
                                </div>
                            {% endif %}
                        </ul>
                        
                        <!-- Pagination navigation -->
                        {% if total_results > per_page %}
                        <nav aria-label="Search results pagination" class="mt-4">
                            <ul class="pagination justify-content-center">
                                <!-- Previous page -->
                                {% if page > 1 %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('search', query=query, original_query=original_query, type=request.args.get('type', ''), lang=request.args.get('lang', ''), page=page-1) }}" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link" aria-hidden="true">&laquo;</span>
                                </li>
                                {% endif %}
                                
                                <!-- Page numbers -->
                                {% set pages = ((total_results / per_page)|round(0, 'ceil'))|int %}
                                {% set max_visible_pages = 5 %}
                                {% set start_page = [1, page - (max_visible_pages//2)]|max %}
                                {% set end_page = [pages, start_page + max_visible_pages - 1]|min %}
                                {% set start_page = [1, end_page - max_visible_pages + 1]|max %}
                                
                                {% if start_page > 1 %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('search', query=query, original_query=original_query, type=request.args.get('type', ''), lang=request.args.get('lang', ''), page=1) }}">1</a>
                                </li>
                                {% if start_page > 2 %}
                                <li class="page-item disabled">
                                    <span class="page-link">...</span>
                                </li>
                                {% endif %}
                                {% endif %}
                                
                                {% for p in range(start_page, end_page + 1) %}
                                <li class="page-item {% if p == page %}active{% endif %}">
                                    <a class="page-link" href="{{ url_for('search', query=query, original_query=original_query, type=request.args.get('type', ''), lang=request.args.get('lang', ''), page=p) }}">{{ p }}</a>
                                </li>
                                {% endfor %}
                                
                                {% if end_page < pages %}
                                {% if end_page < pages - 1 %}
                                <li class="page-item disabled">
                                    <span class="page-link">...</span>
                                </li>
                                {% endif %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('search', query=query, original_query=original_query, type=request.args.get('type', ''), lang=request.args.get('lang', ''), page=pages) }}">{{ pages }}</a>
                                </li>
                                {% endif %}
                                
                                <!-- Next page -->
                                {% if page < pages %}
                                <li class="page-item">
                                    <a class="page-link" href="{{ url_for('search', query=query, original_query=original_query, type=request.args.get('type', ''), lang=request.args.get('lang', ''), page=page+1) }}" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                                {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link" aria-hidden="true">&raquo;</span>
                                </li>
                                {% endif %}
                            </ul>
                        </nav>
                        {% endif %}
                        
                        <!-- Search Engine Links with Improved Design -->
                        <div class="mt-4 mb-4 search-elsewhere-container">
                            <h3 class="mb-3 heading-font">Search elsewhere:</h3>
                            <div class="search-engines-container">
                                <a href="https://www.google.com/search?q={{ query|urlencode }}" target="_blank" class="search-engine-card">
                                    <div class="search-engine-logo google">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                            <!-- Google SVG Path Data -->
                                            <path fill="#4285F4" d="M22.46,12.13c0-0.8-0.07-1.56-0.2-2.31H12v4.36h5.88c-0.26,1.4-1.03,2.6-2.23,3.42v2.81h3.62 C21.43,18.67,22.46,15.69,22.46,12.13z"></path><path fill="#34A853" d="M12,23c3.24,0,5.97-1.07,7.95-2.9l-3.62-2.81c-1.07,0.72-2.45,1.15-4.33,1.15 c-3.31,0-6.12-2.23-7.13-5.23H1.29v2.9C3.24,20.99,7.31,23,12,23z"></path><path fill="#FBBC05" d="M4.87,13.87c-0.2-0.6-0.31-1.25-0.31-1.9s0.11-1.3,0.31-1.9V7.17H1.29c-0.61,1.21-0.97,2.58-0.97,4.01 s0.36,2.8,0.97,4.01L4.87,13.87z"></path><path fill="#EA4335" d="M12,4.85c1.77,0,3.36,0.61,4.6,1.8l3.21-3.21C17.97,1.64,15.24,0,12,0C7.31,0,3.24,2.01,1.29,5.08 l3.58,2.9C5.88,7.08,8.69,4.85,12,4.85z"></path>
                                        </svg>
                                    </div>
                                    <span>Google</span>
                                </a>
                                <a href="https://www.bing.com/search?q={{ query|urlencode }}" target="_blank" class="search-engine-card">
                                    <div class="search-engine-logo bing">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                            <!-- Bing SVG Path Data -->
                                            <path fill="#008373" d="M 4.6816406 3 L 4.6816406 16.775391 L 10.199219 19.685547 L 14.964844 17.023438 L 19.681641 21 L 19.681641 3.3925781 L 15.347656 4.8652344 L 15.347656 14.398438 L 10.199219 11.835938 L 10.199219 5.1289062 L 4.6816406 3 z"></path>
                                        </svg>
                                    </div>
                                    <span>Bing</span>
                                </a>
                                <a href="https://duckduckgo.com/?q={{ query|urlencode }}" target="_blank" class="search-engine-card">
                                    <div class="search-engine-logo ddg">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                            <!-- DuckDuckGo SVG Path Data -->
                                            <path fill="#DE5833" d="M19.95,11.71c-0.2-3.33-2.64-6.06-5.78-6.55c1.17-1.06,1.87-2.58,1.87-4.25C16.04,0.4,15.5,0,14.93,0 c-0.4,0-0.78,0.21-1.05,0.6c-1.07,1.51-3.03,2.48-5.26,2.48S4.42,2.11,3.35,0.6C3.08,0.21,2.7,0,2.29,0C1.73,0,1.19,0.4,1.19,0.91 c0,1.67,0.7,3.19,1.87,4.25C0.16,5.83-0.31,9.37,0.68,12.3c0.3,0.86,0.88,1.63,1.67,2.16c-0.35,0.59-0.57,1.26-0.57,2 c0,0.8,0.31,1.53,0.83,2.1s1.22,0.91,2.02,0.91c1.37,0,2.5-1.12,2.5-2.5c0-0.45-0.12-0.88-0.33-1.25h3.36 c-0.21,0.37-0.33,0.8-0.33,1.25c0,1.38,1.12,2.5,2.5,2.5c0.8,0,1.5-0.35,2.02-0.91s0.83-1.3,0.83-2.1 c0-0.73-0.22-1.41-0.57-2c0.79-0.53,1.37-1.3,1.67-2.16C20.21,12.14,20.07,11.9,19.95,11.71z M8.12,13.58 c-0.86,0-1.56-0.7-1.56-1.56s0.7-1.56,1.56-1.56s1.56,0.7,1.56,1.56S8.98,13.58,8.12,13.58z M15.09,13.58 c-0.86,0-1.56-0.7-1.56-1.56s0.7-1.56,1.56-1.56c0.86,0,1.56,0.7,1.56,1.56S15.95,13.58,15.09,13.58z"></path>
                                        </svg>
                                    </div>
                                    <span>DuckDuckGo</span>
                                </a>
                                <a href="https://www.ecosia.org/search?q={{ query|urlencode }}" target="_blank" class="search-engine-card">
                                    <div class="search-engine-logo ecosia">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                             <!-- Ecosia SVG Path Data -->
                                             <circle cx="12" cy="12" r="10" fill="#75B16D"></circle><path fill="#FFFFFF" d="M12 5.75C8.55 5.75 5.75 8.55 5.75 12c0 3.45 2.8 6.25 6.25 6.25s6.25-2.8 6.25-6.25c0-1.04-.26-2.02-.71-2.89-.66.71-1.59 1.14-2.62 1.14-1.93 0-3.5-1.57-3.5-3.5 0-1.03.43-1.96 1.14-2.62C14.02 5.99 13.04 5.75 12 5.75zm4.92 3.2c-.34-.25-.76-.22-1.05.08-.8.85-1.96 1.37-3.22 1.37-1.68 0-3.16-.89-4.02-2.25-.24-.37-.72-.49-1.09-.25-.37.24-.49.72-.25 1.09.85 1.34 2.24 2.31 3.86 2.54v.37c0 .41.34.75.75.75s.75-.34.75-.75v-.37c1.62-.23 3.01-1.2 3.86-2.54.24-.37.12-.85-.25-1.09z"></path>
                                        </svg>
                                    </div>
                                    <span>Ecosia</span>
                                </a>
                                <a href="https://www.perplexity.ai/search?q={{ query|urlencode }}" target="_blank" class="search-engine-card">
                                    <div class="search-engine-logo perplexity">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                                            <!-- Perplexity SVG Path Data -->
                                             <path fill="#000" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v2.14c.49-.09.99-.14 1.5-.14.34 0 .67.02.99.06V7h2v2.11c.05.64.09 1.3.09 1.97 0 1.39-.22 2.67-.62 3.79l-1.74-1.74c.1-.47.17-.96.17-1.47 0-.82-.14-1.59-.39-2.28H13v3.72c-.41.04-.82.07-1.25.07-.44 0-.87-.03-1.28-.08V11H9V9h2V7zm-2.92 9.47c.3-.27.64-.49.99-.66l-1.6-1.6c-.65.65-1.19 1.4-1.56 2.26zm7.84 0c.35.17.69.39.99.66-.37-.86-.91-1.61-1.56-2.26l-1.6 1.6c.35.17.69.39.99.66zm-.98-4.32c.25.69.39 1.46.39 2.28 0 .51-.07 1-.17 1.47l1.74 1.74c.4-.96.62-2.01.62-3.12 0-.67-.04-1.33-.09-1.97H17V9.06c.32-.04.65-.06.99-.06.51 0 1.01.05 1.5.14V7h-2v2.15z"></path>
                                        </svg>
                                    </div>
                                    <span>Perplexity</span>
                                </a>
                            </div>
                        </div>
                        
                        <!-- Add styling for the search engines -->

                    </div>
                    
                    <!-- Knowledge panel column - only show if knowledge panel data exists -->
                    {% if knowledge_panel %}
                    <div class="knowledge-panel-column">
                        <div class="knowledge-panel">
                            <h3>{{ knowledge_panel.title }}</h3>
                            
                            {% if knowledge_panel.image_url %}
                            <img src="{{ knowledge_panel.image_url }}" alt="{{ knowledge_panel.title }}" class="img-fluid">
                            {% endif %}
                            
                            <p>{{ knowledge_panel.summary }}</p>
                            
                            {% if request.args.get('lang', '').startswith('de') %}
                                {% set wiki_lang = 'de' %}
                                {% set wiki_url = 'https://de.wikipedia.org/wiki/' + knowledge_panel.title.replace(' ', '_') %}
                                <a href="{{ wiki_url }}" target="_blank" class="btn btn-sm btn-outline-primary mt-2">Mehr auf Wikipedia lesen</a>
                                <span class="source">Quelle: Wikipedia</span>
                            {% elif request.args.get('lang', '').startswith('fr') %}
                                {% set wiki_lang = 'fr' %}
                                {% set wiki_url = 'https://fr.wikipedia.org/wiki/' + knowledge_panel.title.replace(' ', '_') %}
                                <a href="{{ wiki_url }}" target="_blank" class="btn btn-sm btn-outline-primary mt-2">Lire plus sur Wikipédia</a>
                                <span class="source">Source: Wikipédia</span>
                            {% elif request.args.get('lang', '').startswith('es') %}
                                {% set wiki_lang = 'es' %}
                                {% set wiki_url = 'https://es.wikipedia.org/wiki/' + knowledge_panel.title.replace(' ', '_') %}
                                <a href="{{ wiki_url }}" target="_blank" class="btn btn-sm btn-outline-primary mt-2">Leer más en Wikipedia</a>
                                <span class="source">Fuente: Wikipedia</span>
                            {% elif request.args.get('lang', '').startswith('it') %}
                                {% set wiki_lang = 'it' %}
                                {% set wiki_url = 'https://it.wikipedia.org/wiki/' + knowledge_panel.title.replace(' ', '_') %}
                                <a href="{{ wiki_url }}" target="_blank" class="btn btn-sm btn-outline-primary mt-2">Ulteriori informazioni su Wikipedia</a>
                                <span class="source">Fonte: Wikipedia</span>
                            {% else %}
                                <a href="{{ knowledge_panel.url }}" target="_blank" class="btn btn-sm btn-outline-primary mt-2">Read more on Wikipedia</a>
                                <span class="source">Source: Wikipedia</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div> <!-- Container schließen, um das Layout-Problem zu beheben -->
        
        {% if ai_response_url %}
        <div id="ai-response-url" data-url="{{ ai_response_url }}" style="display: none;"></div>
        {% endif %}
        
        <!-- Import custom JavaScript files -->
        <script src="{{ url_for('static', filename='js/search.js') }}"></script>
        <script src="{{ url_for('static', filename='js/autocomplete.js') }}"></script>
        <script src="{{ url_for('static', filename='js/preview.js') }}"></script>
        
    {% include 'includes/footer.html' %}
</body>
</html>
